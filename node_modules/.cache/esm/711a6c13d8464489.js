let Users,Codes,bcrypt,getResponse,getErrorResponse,mainConfig;_d84‍.x([["default",()=>_d84‍.o]]);_d84‍.w("../../models/Users/index",[["default",["Users"],function(v){Users=v}]]);_d84‍.w("../../models/Codes/index",[["default",["Codes"],function(v){Codes=v}]]);_d84‍.w("bcrypt",[["default",["bcrypt"],function(v){bcrypt=v}]]);_d84‍.w("../mainModels.js",[["getResponse",["getResponse"],function(v){getResponse=v}],["getErrorResponse",["getErrorResponse"],function(v){getErrorResponse=v}]]);_d84‍.w("../../env",[["default",["mainConfig"],function(v){mainConfig=v}]]);



const accountSid = "AC14f22c42e1101f84c50331cac00ef091";
const authToken = '1f8543155fcc64c8f5b73397ecaf632f';
const crNum = '+18596671471';
const client = require('twilio')(accountSid, authToken);

const nodemailer = require('nodemailer');




class VerificatorServices {

  verification = async (email,phone, codeEmail, codePhone) => {

    const code = new Codes({ email, phone, codeEmail, codePhone })

    code.save();
    // const findPhone = await Codes.findOne({ phone });
    // if (!findPhone) {

    //   return getResponse(false, "phoneNumber is not found");
    // }
    // if (findPhone.codePhone !== code) {

    //   return getResponse(false, "verification code is not valid");
    // }
    return getResponse(true, "success");

  }

  checkPhone = async (phone, code) => {

    const findPhone = await Users.findOne({ phone });
    if (!findPhone) {

      return getResponse(false, "phoneNumber is not found");
    }
    if (findPhone.codePhone !== code) {

      return getResponse(false, "verification code is not valid");
    }
    return getResponse(true, "success");

  }

  checkEmail = async (email, code) => {
    const findEmail = await Users.findOne({ email });
    if (!findEmail) {

      return getResponse(false, "Email is not found");
    }
    if (findEmail.codeEmail !== code) {

      return getResponse(false, "verification code is not valid");
    }
    return getResponse(true, "success");
  }

  sendCode = async (phone, codePhone) => {

    const findPhone = await Users.findOne({ phone });

    if (!findPhone) {

      return getResponse(false, "Phone is not found");
    }

    findPhone.codePhone = codePhone;

    await findPhone.save();

    return getResponse(true, "has been sended");

  }


  sendEmail = async (phone, email, code, codeEmail) => {

    const findPhone = await Users.findOne({ phone });
    if (!findPhone) {

      return getResponse(false, "phoneNumber is not found");
    }
    if (findPhone.codePhone !== code) {

      return getResponse(false, "verification code is not valid");
    }
    if (findPhone.email !== email) {

      return getResponse(false, "email is not correct");
    }

    findPhone.codeEmail = codeEmail;
    await findPhone.save();

    return getResponse(true, `электронный адрес ${findPhone.email}`);
  }

}


_d84‍.d(new VerificatorServices());